jQuery&&function(e){e.extend(e.fn,{uploadify:function(t){e(this).each(function(){var i=e.extend({id:e(this).attr("id"),uploader:"uploadify.swf",script:"uploadify.php",expressInstall:null,folder:"",height:30,width:120,cancelImg:"cancel.png",wmode:"opaque",scriptAccess:"sameDomain",fileDataName:"Filedata",method:"POST",queueSizeLimit:999,simUploadLimit:1,queueID:!1,displayData:"percentage",removeCompleted:!0,onInit:function(){},onSelect:function(){},onSelectOnce:function(){},onQueueFull:function(){},onCheck:function(){},onCancel:function(){},onClearQueue:function(){},onError:function(){},onProgress:function(){},onComplete:function(){},onAllComplete:function(){}},t);e(this).data("settings",i);var a=location.pathname;a=a.split("/"),a.pop(),a=a.join("/")+"/";var n={};if(n.uploadifyID=i.id,n.pagepath=a,i.buttonImg&&(n.buttonImg=escape(i.buttonImg)),i.buttonText&&(n.buttonText=escape(i.buttonText)),i.rollover&&(n.rollover=!0),n.script=i.script,n.folder=escape(i.folder),i.scriptData){var o="";for(var d in i.scriptData)o+="&"+d+"="+i.scriptData[d];n.scriptData=escape(o.substr(1))}n.width=i.width,n.height=i.height,n.wmode=i.wmode,n.method=i.method,n.queueSizeLimit=i.queueSizeLimit,n.simUploadLimit=i.simUploadLimit,i.hideButton&&(n.hideButton=!0),i.fileDesc&&(n.fileDesc=i.fileDesc),i.fileExt&&(n.fileExt=i.fileExt),i.multi&&(n.multi=!0),i.auto&&(n.auto=!0),i.sizeLimit&&(n.sizeLimit=i.sizeLimit),i.checkScript&&(n.checkScript=i.checkScript),i.fileDataName&&(n.fileDataName=i.fileDataName),i.queueID&&(n.queueID=i.queueID),i.onInit()!==!1&&(e(this).css("display","none"),e(this).after('<div id="'+e(this).attr("id")+'Uploader"></div>'),swfobject.embedSWF(i.uploader,i.id+"Uploader",i.width,i.height,"9.0.24",i.expressInstall,n,{quality:"high",wmode:i.wmode,allowScriptAccess:i.scriptAccess},{},function(e){"function"==typeof i.onSWFReady&&e.success&&i.onSWFReady()}),0==i.queueID?e("#"+e(this).attr("id")+"Uploader").after('<div id="'+e(this).attr("id")+'Queue" class="uploadifyQueue"></div>'):e("#"+i.queueID).addClass("uploadifyQueue")),"function"==typeof i.onOpen&&e(this).bind("uploadifyOpen",i.onOpen),e(this).bind("uploadifySelect",{action:i.onSelect,queueID:i.queueID},function(t,a,n){if(t.data.action(t,a,n)!==!1){var o=.01*Math.round(n.size/1024*100),d="KB";o>1e3&&(o=.01*Math.round(.001*o*100),d="MB");var l=o.toString().split(".");o=l.length>1?l[0]+"."+l[1].substr(0,2):l[0],fileName=n.name.length>20?n.name.substr(0,20)+"...":n.name,queue="#"+e(this).attr("id")+"Queue",t.data.queueID&&(queue="#"+t.data.queueID);var u;"tmpl"in window?(u={coreId:a,elementId:e(this).attr("id"),cancelImg:i.cancelImg,fileName:fileName,byteSize:o,suffix:d},e(queue).append(window.tmpl("uploadify-item-template",u))):(u="",u+='<div id="'+e(this).attr("id")+a+'" class="uploadifyQueueItem">',u+='<div class="cancel">',u+="<a href=\"javascript:jQuery('#"+e(this).attr("id")+"').uploadifyCancel('"+a+'\')"><img src="'+i.cancelImg+'" border="0" /></a>',u+="</div>",u+='<span class="fileName">'+fileName+" ("+o+d+')</span><span class="percentage"></span>',u+='<div class="uploadifyProgress">',u+='<div id="'+e(this).attr("id")+a+'ProgressBar" class="uploadifyProgressBar"><!--Progress Bar--></div>',u+="</div>",u+="</div>",e(queue).append(u))}}),e(this).bind("uploadifySelectOnce",{action:i.onSelectOnce},function(t,a){t.data.action(t,a),i.auto&&(i.checkScript?e(this).uploadifyUpload(null,!1):e(this).uploadifyUpload(null,!0))}),e(this).bind("uploadifyQueueFull",{action:i.onQueueFull},function(e,t){e.data.action(e,t)!==!1&&alert("The queue is full.  The max size is "+t+".")}),e(this).bind("uploadifyCheckExist",{action:i.onCheck},function(t,i,n,o,d){var l=new Object;if(l=n,l.folder="/"==o.substr(0,1)?o:a+o,d)for(var u in n)var s=u;e.post(i,l,function(i){for(var a in i)if(t.data.action(t,i,a)!==!1){var n=confirm("Do you want to replace the file "+i[a]+"?");n||document.getElementById(e(t.target).attr("id")+"Uploader").cancelFileUpload(a,!0,!0)}d?document.getElementById(e(t.target).attr("id")+"Uploader").startFileUpload(s,!0):document.getElementById(e(t.target).attr("id")+"Uploader").startFileUpload(null,!0)},"json")}),e(this).bind("uploadifyCancel",{action:i.onCancel},function(t,i,a,n,o,d){if(t.data.action(t,i,a,n,d)!==!1&&o){var l=1==d?0:250;e("#"+e(this).attr("id")+i).fadeOut(l,function(){e(this).remove()})}}),e(this).bind("uploadifyClearQueue",{action:i.onClearQueue},function(t,a){var n=i.queueID?i.queueID:e(this).attr("id")+"Queue";a&&e("#"+n).find(".uploadifyQueueItem").remove(),t.data.action(t,a)!==!1&&e("#"+n).find(".uploadifyQueueItem").each(function(){var t=e(".uploadifyQueueItem").index(this);e(this).delay(100*t).fadeOut(250,function(){e(this).remove()})})});var l=[];e(this).bind("uploadifyError",{action:i.onError},function(t,i,a,n){if(t.data.action(t,i,a,n)!==!1){var o=new Array(i,a,n);l.push(o),e("#"+e(this).attr("id")+i).find(".percentage").text(" - "+n.type+" Error"),e("#"+e(this).attr("id")+i).find(".uploadifyProgress").hide(),e("#"+e(this).attr("id")+i).addClass("uploadifyError")}}),"function"==typeof i.onUpload&&e(this).bind("uploadifyUpload",i.onUpload),e(this).bind("uploadifyProgress",{action:i.onProgress,toDisplay:i.displayData},function(t,i,a,n){t.data.action(t,i,a,n)!==!1&&(e("#"+e(this).attr("id")+i+"ProgressBar").animate({width:n.percentage+"%"},250,function(){100==n.percentage&&e(this).closest(".uploadifyProgress").fadeOut(250,function(){e(this).remove()})}),"percentage"==t.data.toDisplay&&(displayData=" - "+n.percentage+"%"),"speed"==t.data.toDisplay&&(displayData=" - "+n.speed+"KB/s"),null==t.data.toDisplay&&(displayData=" "),e("#"+e(this).attr("id")+i).find(".percentage").text(displayData))}),e(this).bind("uploadifyComplete",{action:i.onComplete},function(t,a,n,o,d){t.data.action(t,a,n,unescape(o),d)!==!1&&(e("#"+e(this).attr("id")+a).find(".percentage").text(" - Completed"),i.removeCompleted&&e("#"+e(t.target).attr("id")+a).fadeOut(250,function(){e(this).remove()}),e("#"+e(t.target).attr("id")+a).addClass("completed"))}),"function"==typeof i.onAllComplete&&e(this).bind("uploadifyAllComplete",{action:i.onAllComplete},function(e,t){e.data.action(e,t)!==!1&&(l=[])})})},uploadifySettings:function(t,i,a){var n=!1;if(e(this).each(function(){if("scriptData"==t&&null!=i){if(a)var o=i;else var o=e.extend(e(this).data("settings").scriptData,i);var d="";for(var l in o)d+="&"+l+"="+o[l];i=escape(d.substr(1))}n=document.getElementById(e(this).attr("id")+"Uploader").updateSettings(t,i)}),null==i&&"scriptData"==t){for(var o=unescape(n).split("&"),d=new Object,l=0;l<o.length;l++){var u=o[l].split("=");d[u[0]]=u[1]}n=d}return n},uploadifyUpload:function(t,i){e(this).each(function(){i||(i=!1),document.getElementById(e(this).attr("id")+"Uploader").startFileUpload(t,i)})},uploadifyCancel:function(t){e(this).each(function(){document.getElementById(e(this).attr("id")+"Uploader").cancelFileUpload(t,!0,!0,!1)})},uploadifyClearQueue:function(){e(this).each(function(){document.getElementById(e(this).attr("id")+"Uploader").clearFileUploadQueue(!1)})}})}(jQuery);